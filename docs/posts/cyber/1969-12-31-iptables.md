---
title: Iptables
slug: iptables
date_published: 1970-01-01T00:00:00.000Z
date_updated: 2023-04-29T18:03:00.000Z
draft: true
---

Ubuntu can be a bit confusing when it comes to it's de-facto firewall, UFW. This is especially so with around versions 20 and 22 of Ubuntu, now that nftables has come into play.

So, if you are using UFW on Ubuntu 20 and 22, you might actually have 2 underlying systems that come into play to inplement the rules for UFW. When you set the rules in UFW, these rules are actually carried out by it's soldier, iptables. But! With the advent of nftables, this is complicated by the fact that if you have some application using the OLD iptables.

Starting with Ubuntu 20.04, nftables became the default backend for UFW.

To clarify, run the following on your Ubuntu system if you have 20.04 and newer:

`update-alternatives --config iptables`

On my system, I get the following:
![](__GHOST_URL__/content/images/2023/04/Screenshot-from-2023-04-28-13-07-48.png)Notice iptables-nft and iptables-legacy
This shows the 2 subsystems that can come into play, iptables-nft and iptables-legacy. The newer nftables is actually masquerading as iptables-nft and the iptables-legacy is the older system.

What does this all mean? Well, if you have an app that is still using the iptables-legacy system, you can actually have 2 sets of iptables rules. If you know which apps are using the legacy, then you can decide whether you want to remove the legacy. I did so, with the following commands, noted [here](https://askubuntu.com/questions/1295021/warning-iptables-legacy-tables-present):
`
sudo rmmod iptable_filter
sudo rmmod iptable_nat
sudo rmmod iptable_mangle
sudo rmmod iptable_raw
`
If you are like me and prefer to just use iptables directly instead of UFW, you can disable UFW:

`sudo systemctl disable --now ufw`

And if all that wasn't confusing enough, you can access nftables either with 'iptables' or with:

`sudo nft list ruleset`

Docker seems to be the main culprit in reactivating iptables-legacy. I have disabled the Docker services:
`
sudo systemctl disable docker.service
`
And even then, the rules in iptables-legacy are back after reboot. I can tell Docker is adding them as they are all named after Docker service.

Next, I try to blacklist the iptables-legacy modules, by adding the following in the /etc/modprobe.d/blacklist.conf file. OK, nevermind the blacklist file. Didn't work.

In the end, I removed iptables via

`sudo apt-get purge iptables`

and moved on... To nftables. Before purging iptables, I believe you need to remove all the rules and flush and more. Check out a good article [here](https://www.cyberciti.biz/tips/linux-iptables-how-to-flush-all-rules.html) for that.
