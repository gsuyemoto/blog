---
title: Nftables in Ubuntu
slug: nftables
date_published: 1970-01-01T00:00:00.000Z
date_updated: 2023-05-10T06:16:41.000Z
draft: true
---

The future??

I'm a big Ubuntu user and it's 2023 and I just realized that iptables are being replaced by nftables and that this has been in place since Ubuntu 20.04. I came to this realization after with much frustration I purged Docker (which I now consider a malware) from my system.

Docker loves, I mean really takes great pleasure, in messing with your iptables. I was using UFW for a while now, which used to use iptables as it's underlying mechanism. Since Ubuntu 20.04, when nftables were added, iptables were moved to iptables-legacy and nftables was slid into the old position as an iptables link. Yet, Docker, in it's infinite wisdom does not alter iptables (the nftables kind, AKA iptables-nft â€“ really??), but iptables-legacy.

So, for all of you using UFW and Docker will have to contend with the problem of conflicting settings. UFW has it's rules set with iptables-nft and Docker is mischievously setting iptables-legacy. What's more, I killed the Docker process and upon reboot, the Docker rules were still around in iptables-legacy. After a full day of messing around and cursing Docker, I purged Docker AND iptables.

Now, I'm stuck with nftables whether for good or bad.

Looking around, nftables documentation seems to be a bit sparse. I came across an example of a quick and *easy *setup from [wiki.nftables.org](https://wiki.nftables.org/wiki-nftables/index.php/Simple_ruleset_for_a_server). Seems promising, right? Didn't work. I mean, the nftables service started right up with no errors, but I had modified the file to only accept 443 via https. If you take a look at the file, it seems like a no brainer. I could be wrong, but it seems the config file is set up to only allow port traffic from 22,80 and 443 and therefore, I should be able to just remove 22 and 80, right? Anyways, I couldn't get that to work. On to doing things the hard way.

There doesn't seem all that much info about creating the nft rules from scratch on the command line, where it would be nice to try things out before putting everything in writing in a config file. Alas, I found [something](https://unix.stackexchange.com/questions/537912/nftables-rule-no-such-file-or-directory-error) that worked for me. Thanks, Amos. That snippet helped me along, but what really was a great resouce was [this](https://wiki.gentoo.org/wiki/Nftables/Examples) post.

Also, remember this command:

`sudo nft list ruleset`

Which, if you run this command and you get nothing back and know that you have rules set in your config file, then most likely your nftables service is not running. Try

`sudo service nftables restart`

You'll need it to check out your current rules in nftables. The nftables service, by default, gets it's configuration from a file located at:

`/etc/nftables.conf`

Which you can confirm by checking the status of the service itself:

`sudo service nftables status`

Which will list the location of the configuration, also.

Also, make sure to enable the service so that your changes will be saved on reboot:

`sudo systemctl enable nftables`
