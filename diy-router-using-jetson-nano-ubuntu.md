<h1>DIY Router using Jetson Nano & Ubuntu</h1>
<p>I've had my Google router for a while now (since 2018) and I'm frankly tired of it. Performance is not good and reliability not so good either. So, it's time to build my own!</p><p>Coincidentally, I've also had a Jetson Nano lying around that I've wanted to use to stream some possibly DIY security cameras for local and more importantly PRIVATE computer vision processing. Having <a href="https://www.bbc.com/news/technology-51048406">Amazon engineers</a> and whoever have access to my security cameras is not altogether comforting. And like the Google router, the performance sucks.</p><p>So, why not create my own router with the Jetson!? I thought. Well, why the heck not.</p><p>I came across a <a href="https://pythops.com/post/create-your-own-image-for-jetson-nano-board">great article</a> on how to create a custom image for the Jetson and I decided to use it as a baseline configuration considering it's basically just the bare essentials. Plus! It will allow me to create an image for all of you who want to try the same thing, making things MUCH easier for you!</p><p>Some changes are needed to the image and Ansible configuration:</p><ol><li><s>Need to install network-manager as netplan is <a href="https://askubuntu.com/questions/1166619/define-hostapd-configuration-settings-on-netplan">unable to create AP</a> using networkd as renderer.</s> OK, nevermind netplan. Could not get the AP to work in a or g mode using a wireless AC USB adapter. Need to install and use hostapd instead. Also, need to set channel to 40. Tried 36 and would not work.</li><li>Add hostname to /etc/hostname file.</li></ol><p>If you are using the recommended wireless adapter mentioned in the parts list, then you should install the drivers for it from <a href="https://github.com/aircrack-ng/rtl8812au">here</a>. Getting the right wireless adapter to work with Linux is a feat in itself as your choices are quite narrow, but if you want to set up your own AP AND have that AP broadcast on 5GHz then you really have a challenge on your hands. The recommended adapter was the only one I found to work out of 5 that I tried. All of the others might be 5GHz capable, but all ran into the regulatory domain restrictions that didn't allow that particular card to work in AP mode at 5GHz.</p><p>Now for the iptables. In order for the packets to stream freely from wlan0 (your AP) back and forth from eth0 (your WAN). First, make sure you set ip forwarding:</p><!--kg-card-begin: markdown--><p><code>echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward</code></p>\
<!--kg-card-end: markdown--><p>To ensure that the ip forwarding is persisted on reboot. Find and remove the commenting for the following line in your /etc/sysctl.conf:</p><!--kg-card-begin: markdown--><p><code>net.ipv4.ip_forward = 1</code></p>\
<!--kg-card-end: markdown--><p>And then add dynamic addressing:</p><!--kg-card-begin: markdown--><p><code>echo 1 | sudo tee /proc/sys/net/ipv4/ip_dynaddr</code></p>\
<!--kg-card-end: markdown--><p>Then you will need to set these iptables rules:</p><!--kg-card-begin: markdown--><p><code>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>\
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state ESTABLISHED,RELATED -j ACCEPT<br>\
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT<br>\
</code></p>\
<!--kg-card-end: markdown--><p>Save the rules with iptables-persistent by entering this command:</p><!--kg-card-begin: markdown--><p><code>sudo iptables-save</code></p>\
<!--kg-card-end: markdown--><p>You can check if you are actually connected and using 802.11ac bandwidth with the command:</p><!--kg-card-begin: markdown--><p><code>sudo iw wlan0 station dump</code></p>\
<!--kg-card-end: markdown-->
